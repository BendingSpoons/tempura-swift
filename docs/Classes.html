<!DOCTYPE html>
<html lang="en">
  <head>
    <title>Classes  Reference</title>
    <link rel="stylesheet" type="text/css" href="css/jazzy.css" />
    <link rel="stylesheet" type="text/css" href="css/highlight.css" />
    <meta charset='utf-8'>
    <script src="js/jquery.min.js" defer></script>
    <script src="js/jazzy.js" defer></script>
    
  </head>
  <body>
    <a title="Classes  Reference"></a>
    <header>
      <div class="content-wrapper">
        <p><a href="index.html">Tempura Docs</a> (100% documented)</p>
        <p class="header-right"><a href="https://github.com/BendingSpoons/tempura-swift"><img src="img/gh.png"/>View on GitHub</a></p>
      </div>
    </header>
    <div class="content-wrapper">
      <p id="breadcrumbs">
        <a href="index.html">Tempura Reference</a>
        <img id="carat" src="img/carat.png" />
        Classes  Reference
      </p>
    </div>
    <div class="content-wrapper">
      <nav class="sidebar">
        <ul class="nav-groups">
          <li class="nav-group-name">
            <a href="Classes.html">Classes</a>
            <ul class="nav-group-tasks">
              <li class="nav-group-task">
                <a href="Classes/Navigator.html">Navigator</a>
              </li>
              <li class="nav-group-task">
                <a href="Classes/ViewController.html">ViewController</a>
              </li>
              <li class="nav-group-task">
                <a href="Classes/ViewControllerWithLocalState.html">ViewControllerWithLocalState</a>
              </li>
            </ul>
          </li>
          <li class="nav-group-name">
            <a href="Enums.html">Enumerations</a>
            <ul class="nav-group-tasks">
              <li class="nav-group-task">
                <a href="Enums/NavigationInstruction.html">NavigationInstruction</a>
              </li>
              <li class="nav-group-task">
                <a href="Enums/NavigationInstruction/ModalDismissBehaviour.html">â€“ ModalDismissBehaviour</a>
              </li>
            </ul>
          </li>
          <li class="nav-group-name">
            <a href="Extensions.html">Extensions</a>
            <ul class="nav-group-tasks">
              <li class="nav-group-task">
                <a href="Extensions/UIApplication.html">UIApplication</a>
              </li>
              <li class="nav-group-task">
                <a href="Extensions/UIViewController.html">UIViewController</a>
              </li>
            </ul>
          </li>
          <li class="nav-group-name">
            <a href="Protocols.html">Protocols</a>
            <ul class="nav-group-tasks">
              <li class="nav-group-task">
                <a href="Protocols/LocalState.html">LocalState</a>
              </li>
              <li class="nav-group-task">
                <a href="Protocols/ModellableView.html">ModellableView</a>
              </li>
              <li class="nav-group-task">
                <a href="Protocols/NavigationProvider.html">NavigationProvider</a>
              </li>
              <li class="nav-group-task">
                <a href="Protocols/RootInstaller.html">RootInstaller</a>
              </li>
              <li class="nav-group-task">
                <a href="Protocols/Routable.html">Routable</a>
              </li>
              <li class="nav-group-task">
                <a href="Protocols/RoutableWithConfiguration.html">RoutableWithConfiguration</a>
              </li>
              <li class="nav-group-task">
                <a href="Protocols/View.html">View</a>
              </li>
              <li class="nav-group-task">
                <a href="Protocols/ViewControllerModellableView.html">ViewControllerModellableView</a>
              </li>
              <li class="nav-group-task">
                <a href="Protocols.html#/s:7Tempura9ViewModelP">ViewModel</a>
              </li>
              <li class="nav-group-task">
                <a href="Protocols/ViewModelWithLocalState.html">ViewModelWithLocalState</a>
              </li>
              <li class="nav-group-task">
                <a href="Protocols/ViewModelWithState.html">ViewModelWithState</a>
              </li>
            </ul>
          </li>
          <li class="nav-group-name">
            <a href="Structs.html">Structures</a>
            <ul class="nav-group-tasks">
              <li class="nav-group-task">
                <a href="Structs/Hide.html">Hide</a>
              </li>
              <li class="nav-group-task">
                <a href="Structs/Navigate.html">Navigate</a>
              </li>
              <li class="nav-group-task">
                <a href="Structs/NavigationRequest.html">NavigationRequest</a>
              </li>
              <li class="nav-group-task">
                <a href="Structs/Show.html">Show</a>
              </li>
            </ul>
          </li>
          <li class="nav-group-name">
            <a href="Typealiases.html">Type Aliases</a>
            <ul class="nav-group-tasks">
              <li class="nav-group-task">
                <a href="Typealiases.html#/s:7Tempura29CustomNavigationOptionClosurea">CustomNavigationOptionClosure</a>
              </li>
              <li class="nav-group-task">
                <a href="Typealiases.html#/s:7Tempura11Interactiona">Interaction</a>
              </li>
              <li class="nav-group-task">
                <a href="Typealiases.html#/s:7Tempura5Routea">Route</a>
              </li>
              <li class="nav-group-task">
                <a href="Typealiases.html#/s:7Tempura22RouteElementIdentifiera">RouteElementIdentifier</a>
              </li>
              <li class="nav-group-task">
                <a href="Typealiases.html#/s:7Tempura17RoutingCompletiona">RoutingCompletion</a>
              </li>
            </ul>
          </li>
        </ul>
      </nav>
      <article class="main-content">
        <section>
          <section class="section">
            <h1>Classes</h1>
            <p>The following classes are available globally.</p>

          </section>
          <section class="section task-group-section">
            <div class="task-group">
              <ul>
                <li class="item">
                  <div>
                    <code>
                    <a name="/s:7Tempura14ViewControllerC"></a>
                    <a name="//apple_ref/swift/Class/ViewController" class="dashAnchor"></a>
                    <a class="token" href="#/s:7Tempura14ViewControllerC">ViewController</a>
                    </code>
                  </div>
                  <div class="height-container">
                    <div class="pointer-container"></div>
                    <section class="section">
                      <div class="pointer"></div>
                      <div class="abstract">
                        <p>Manages a screen of your app, it keeps the UI updated and listens for user interactions.</p>
<h2 id='overview' class='heading'>Overview</h2>

<p>In Tempura, a Screen is composed by three different elements that interoperate in order to get the actual
pixels on the screen and to keep them updated when the state changes.
These are ViewController, <code><a href="Protocols/ViewModelWithState.html">ViewModelWithState</a></code> and <code><a href="Protocols/ViewControllerModellableView.html">ViewControllerModellableView</a></code>.
The ViewController is a subclass of <code>UIViewController</code> that is responsible to manage the set of views that are shown in each screen of your UI.</p>
<pre class="highlight swift"><code>   <span class="kd">struct</span> <span class="kt">CounterState</span><span class="p">:</span> <span class="kt">State</span> <span class="p">{</span>
     <span class="k">var</span> <span class="nv">counter</span><span class="p">:</span> <span class="kt">Int</span> <span class="o">=</span> <span class="mi">0</span>
   <span class="p">}</span>
</code></pre>
<pre class="highlight swift"><code>   <span class="kd">struct</span> <span class="kt">IncrementCounter</span><span class="p">:</span> <span class="kt">Action</span> <span class="p">{</span>
     <span class="kd">func</span> <span class="nf">updatedState</span><span class="p">(</span><span class="k">inout</span> <span class="nv">currentState</span><span class="p">:</span> <span class="kt">CounterState</span><span class="p">)</span> <span class="p">{</span>
       <span class="n">currentState</span><span class="o">.</span><span class="n">counter</span> <span class="o">+=</span> <span class="mi">1</span>
     <span class="p">}</span>
   <span class="p">}</span>
</code></pre>
<pre class="highlight swift"><code>   <span class="kd">struct</span> <span class="kt">DecrementCounter</span><span class="p">:</span> <span class="kt">Action</span> <span class="p">{</span>
     <span class="kd">func</span> <span class="nf">updatedState</span><span class="p">(</span><span class="k">inout</span> <span class="nv">currentState</span><span class="p">:</span> <span class="kt">CounterState</span><span class="p">)</span> <span class="p">{</span>
       <span class="n">currentState</span><span class="o">.</span><span class="n">counter</span> <span class="o">-=</span> <span class="mi">1</span>
     <span class="p">}</span>
   <span class="p">}</span>
</code></pre>
<pre class="highlight swift"><code>   <span class="kd">struct</span> <span class="kt">CounterViewModel</span><span class="p">:</span> <span class="kt">ViewModelWithState</span> <span class="p">{</span>
     <span class="k">var</span> <span class="nv">countDescription</span><span class="p">:</span> <span class="kt">String</span>

     <span class="nf">init</span><span class="p">(</span><span class="nv">state</span><span class="p">:</span> <span class="kt">CounterState</span><span class="p">)</span> <span class="p">{</span>
       <span class="k">self</span><span class="o">.</span><span class="n">countDescription</span> <span class="o">=</span> <span class="s">"the counter is at </span><span class="se">\(</span><span class="n">state</span><span class="o">.</span><span class="n">counter</span><span class="se">)</span><span class="s">"</span>
     <span class="p">}</span>
   <span class="p">}</span>
</code></pre>
<pre class="highlight swift"><code>   <span class="kd">class</span> <span class="kt">CounterView</span><span class="p">:</span> <span class="kt">UIView</span><span class="p">,</span> <span class="kt">ViewControllerModellableView</span> <span class="p">{</span>

     <span class="c1">// subviews</span>
     <span class="k">var</span> <span class="nv">counterLabel</span> <span class="o">=</span> <span class="kt">UILabel</span><span class="p">()</span>
     <span class="k">var</span> <span class="nv">addButton</span> <span class="o">=</span> <span class="kt">UIButton</span><span class="p">(</span><span class="nv">type</span><span class="p">:</span> <span class="o">.</span><span class="n">custom</span><span class="p">)</span>
     <span class="k">var</span> <span class="nv">subButton</span> <span class="o">=</span> <span class="kt">UIButton</span><span class="p">(</span><span class="nv">type</span><span class="p">:</span> <span class="o">.</span><span class="n">custom</span><span class="p">)</span>

     <span class="c1">// interactions</span>
     <span class="k">var</span> <span class="nv">didTapAdd</span><span class="p">:</span> <span class="kt">Interaction</span><span class="p">?</span>
     <span class="k">var</span> <span class="nv">didTapSub</span><span class="p">:</span> <span class="kt">Interaction</span><span class="p">?</span>

     <span class="c1">// setup</span>
     <span class="kd">func</span> <span class="nf">setup</span><span class="p">()</span> <span class="p">{</span>
       <span class="k">self</span><span class="o">.</span><span class="n">addButton</span><span class="o">.</span><span class="nf">on</span><span class="p">(</span><span class="o">.</span><span class="n">touchUpInside</span><span class="p">)</span> <span class="p">{</span> <span class="p">[</span><span class="k">unowned</span> <span class="k">self</span><span class="p">]</span> <span class="n">button</span> <span class="k">in</span>
         <span class="k">self</span><span class="o">.</span><span class="nf">didTapAdd</span><span class="p">?()</span>
       <span class="p">}</span>
       <span class="k">self</span><span class="o">.</span><span class="n">subButton</span><span class="o">.</span><span class="nf">on</span><span class="p">(</span><span class="o">.</span><span class="n">touchUpInside</span><span class="p">)</span> <span class="p">{</span> <span class="p">[</span><span class="k">unowned</span> <span class="k">self</span><span class="p">]</span> <span class="n">button</span> <span class="k">in</span>
         <span class="k">self</span><span class="o">.</span><span class="nf">didTapSub</span><span class="p">?()</span>
       <span class="p">}</span>
       <span class="k">self</span><span class="o">.</span><span class="nf">addSubview</span><span class="p">(</span><span class="k">self</span><span class="o">.</span><span class="n">counterLabel</span><span class="p">)</span>
       <span class="k">self</span><span class="o">.</span><span class="nf">addSubview</span><span class="p">(</span><span class="k">self</span><span class="o">.</span><span class="n">subButton</span><span class="p">)</span>
       <span class="k">self</span><span class="o">.</span><span class="nf">addSubview</span><span class="p">(</span><span class="k">self</span><span class="o">.</span><span class="n">addButton</span><span class="p">)</span>
     <span class="p">}</span>

     <span class="c1">// style</span>
     <span class="kd">func</span> <span class="nf">style</span><span class="p">()</span> <span class="p">{</span>
       <span class="k">self</span><span class="o">.</span><span class="n">backgroundColor</span> <span class="o">=</span> <span class="o">.</span><span class="n">white</span>
       <span class="k">self</span><span class="o">.</span><span class="n">addButton</span><span class="o">.</span><span class="nf">setTitle</span><span class="p">(</span><span class="s">"Add"</span><span class="p">,</span> <span class="nv">for</span><span class="p">:</span> <span class="o">.</span><span class="n">normal</span><span class="p">)</span>
       <span class="k">self</span><span class="o">.</span><span class="n">subButton</span><span class="o">.</span><span class="nf">setTitle</span><span class="p">(</span><span class="s">"Sub"</span><span class="p">,</span> <span class="nv">for</span><span class="p">:</span> <span class="o">.</span><span class="n">normal</span><span class="p">)</span>
     <span class="p">}</span>

     <span class="c1">// update</span>
     <span class="kd">func</span> <span class="nf">update</span><span class="p">(</span><span class="nv">oldModel</span><span class="p">:</span> <span class="kt">CounterViewModel</span><span class="p">?)</span> <span class="p">{</span>
       <span class="k">self</span><span class="o">.</span><span class="n">counterLabel</span><span class="o">.</span><span class="n">text</span> <span class="o">=</span> <span class="k">self</span><span class="o">.</span><span class="n">model</span><span class="p">?</span><span class="o">.</span><span class="n">countDescription</span>
       <span class="k">self</span><span class="o">.</span><span class="nf">setNeedsLayout</span><span class="p">()</span>
     <span class="p">}</span>

     <span class="c1">// layout</span>
     <span class="k">override</span> <span class="kd">func</span> <span class="nf">layoutSubviews</span><span class="p">()</span> <span class="p">{</span>
       <span class="k">self</span><span class="o">.</span><span class="n">counterLabel</span><span class="o">.</span><span class="nf">sizeToFit</span><span class="p">()</span>
       <span class="k">self</span><span class="o">.</span><span class="n">addButton</span><span class="o">.</span><span class="n">frame</span> <span class="o">=</span> <span class="kt">CGRect</span><span class="p">(</span><span class="nv">x</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span> <span class="nv">y</span><span class="p">:</span> <span class="mi">100</span><span class="p">,</span> <span class="nv">width</span><span class="p">:</span> <span class="mi">100</span><span class="p">,</span> <span class="nv">height</span><span class="p">:</span> <span class="mi">44</span><span class="p">)</span>
       <span class="k">self</span><span class="o">.</span><span class="n">subButton</span><span class="o">.</span><span class="n">frame</span> <span class="o">=</span> <span class="kt">CGRect</span><span class="p">(</span><span class="nv">x</span><span class="p">:</span> <span class="mi">100</span><span class="p">,</span> <span class="nv">y</span><span class="p">:</span> <span class="mi">100</span><span class="p">,</span> <span class="nv">width</span><span class="p">:</span> <span class="mi">100</span><span class="p">,</span> <span class="nv">height</span><span class="p">:</span> <span class="mi">44</span><span class="p">)</span>
     <span class="p">}</span>
   <span class="p">}</span>
</code></pre>
<pre class="highlight swift"><code>   <span class="kd">class</span> <span class="kt">CounterViewController</span><span class="p">:</span> <span class="kt">ViewController</span><span class="o">&lt;</span><span class="kt">CounterView</span><span class="o">&gt;</span> <span class="p">{</span>

   <span class="k">override</span> <span class="kd">func</span> <span class="nf">setupInteraction</span><span class="p">()</span> <span class="p">{</span>
     <span class="k">self</span><span class="o">.</span><span class="n">rootView</span><span class="o">.</span><span class="n">didTapAdd</span> <span class="o">=</span> <span class="p">{</span> <span class="p">[</span><span class="k">unowned</span> <span class="k">self</span><span class="p">]</span> <span class="k">in</span>
       <span class="k">self</span><span class="o">.</span><span class="nf">dispatch</span><span class="p">(</span><span class="kt">IncrementCounter</span><span class="p">())</span>
     <span class="p">}</span>
     <span class="k">self</span><span class="o">.</span><span class="n">rootView</span><span class="o">.</span><span class="n">didTapSub</span> <span class="o">=</span> <span class="p">{</span> <span class="p">[</span><span class="k">unowned</span> <span class="k">self</span><span class="p">]</span> <span class="k">in</span>
       <span class="k">self</span><span class="o">.</span><span class="nf">dispatch</span><span class="p">(</span><span class="kt">DecrementCounter</span><span class="p">())</span>
     <span class="p">}</span>
   <span class="p">}</span>
</code></pre>
<h2 id='lifecycle-of-a-viewcontroller' class='heading'>Lifecycle of a ViewController</h2>

<p>In order to instantiate a ViewController&rsquo;s subclass you need to provide a Katana <code>Store</code> instance.
This instance will be used by the ViewController to listen for state updates.</p>
<pre class="highlight swift"><code>   <span class="k">let</span> <span class="nv">vc</span> <span class="o">=</span> <span class="kt">CounterViewController</span><span class="p">(</span><span class="nv">store</span><span class="p">:</span> <span class="n">appStore</span><span class="p">)</span>
</code></pre>

<p>When a ViewController is created it will start receiving state updates as soon as the <code>connected</code> property
will become <code>true</code>.</p>

<p>When the ViewController becomes visible, the UIKit <code>UIViewController.viewWillAppear()</code> will be called and
Tempura will set <code>connected</code> to <code>true</code> and the ViewController will start receiving the updates
from the state.
If you don&rsquo;t want this to happen automatically every time the ViewController will become visible, set
<code>shouldConnectWhenVisible</code> to <code>false</code>.</p>

<p>As soon a new state is available from the Katana store, the ViewController will instantiate a new ViewModel
out of that state and feed the <code>rootView</code> with that, calling <code><a href="Protocols/ModellableView.html#/s:7Tempura14ModellableViewP6updatey2VMQzSg8oldModel_tF">ModellableView.update(oldModel:)</a></code></p>

<p>When something happens inside the <code><a href="Protocols/ViewControllerModellableView.html">ViewControllerModellableView</a></code> (or its subviews)
the ViewController is responsible to listen for these <code><a href="Typealiases.html#/s:7Tempura11Interactiona">Interaction</a></code> callbacks and react accordingly
dispatching actions in order to change the state.</p>

<p>When a ViewController is removed from the hierarchy or hidden by some other ViewController, UIKit will call
<code>UIViewController.viewWillDisappear()</code> and Tempura will set <code>connected</code> to <code>false</code>, detaching the
ViewController from the state updates.
If you don&rsquo;t want this to happen automatically every time the ViewControllet will become invisible,
set <code>sholdDisconnectWhenInvisible</code> to <code>false</code></p>

                        <a href="Classes/ViewController.html" class="slightly-smaller">See more</a>
                      </div>
                      <div class="declaration">
                        <h4>Declaration</h4>
                        <div class="language">
                          <p class="aside-title">Swift</p>
                          <pre class="highlight swift"><code><span class="kd">open</span> <span class="kd">class</span> <span class="kt">ViewController</span><span class="o">&lt;</span><span class="kt">V</span><span class="p">:</span> <span class="kt"><a href="Protocols/ViewControllerModellableView.html">ViewControllerModellableView</a></span> <span class="o">&amp;</span> <span class="kt">UIView</span><span class="o">&gt;</span><span class="p">:</span> <span class="kt">UIViewController</span></code></pre>

                        </div>
                      </div>
                      <div class="slightly-smaller">
                        <a href="https://github.com/BendingSpoons/tempura-lib-swift/blob/master//Tempura/Core/ViewController.swift#L146-L343">Show on GitHub</a>
                      </div>
                    </section>
                  </div>
                </li>
              </ul>
            </div>
            <div class="task-group">
              <ul>
                <li class="item">
                  <div>
                    <code>
                    <a name="/s:7Tempura28ViewControllerWithLocalStateC"></a>
                    <a name="//apple_ref/swift/Class/ViewControllerWithLocalState" class="dashAnchor"></a>
                    <a class="token" href="#/s:7Tempura28ViewControllerWithLocalStateC">ViewControllerWithLocalState</a>
                    </code>
                  </div>
                  <div class="height-container">
                    <div class="pointer-container"></div>
                    <section class="section">
                      <div class="pointer"></div>
                      <div class="abstract">
                        <p>Special case of a <code><a href="Classes/ViewController.html">ViewController</a></code> that contains a <code><a href="Protocols/LocalState.html">LocalState</a></code>.</p>
<h2 id='overview' class='heading'>Overview</h2>

<p>A <code><a href="Classes/ViewController.html">ViewController</a></code> is managing the UI of a screen, listening for Katana global state changes, keeping the UI updated
and dispatching actions in response to user interactions in order to change the global state.</p>

<p>There are times when you have some kind of state information that is only specific to the screen managed
by a ViewController, like for instance the item selected in a list.
In this case, in order to avoid polluting the global state, you can represent that information inside
a <code><a href="Protocols/LocalState.html">LocalState</a></code> and promote that ViewController to be a <code>ViewControllerWithLocalState</code>.</p>

<p>A ViewControllerWithLocalState contains a <code>localState</code> variable that you can change directly in order
to represent local state changes.
The ViewControllerWithLocalState will be listening for changes of both global and local states, updating
the UI using the appropriate <code><a href="Protocols/ViewModelWithLocalState.html">ViewModelWithLocalState</a></code>.</p>

<p>You can change the global state dispatching Katana actions like in every <code><a href="Classes/ViewController.html">ViewController</a></code>. You can change
the <code><a href="Protocols/LocalState.html">LocalState</a></code> manipulating directly the <code>localState</code> variable.</p>

<p>The lifecycle of a ViewControllerWithLocalState is the same as a normal <code><a href="Classes/ViewController.html">ViewController</a></code>, please refer to that
for more details.</p>
<pre class="highlight swift"><code>   <span class="kd">struct</span> <span class="kt">GlobalState</span><span class="p">:</span> <span class="kt">State</span> <span class="p">{</span>
     <span class="k">var</span> <span class="nv">todos</span><span class="p">:</span> <span class="p">[</span><span class="kt">String</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span>
       <span class="s">"buy milk"</span><span class="p">,</span>
       <span class="s">"find a unicorn"</span><span class="p">,</span>
       <span class="s">"visit Rome"</span>
     <span class="p">]</span>
   <span class="p">}</span>
</code></pre>
<pre class="highlight swift"><code>   <span class="kd">struct</span> <span class="kt">RemoveTodo</span><span class="p">:</span> <span class="kt">AppAction</span> <span class="p">{</span>
     <span class="k">var</span> <span class="nv">index</span><span class="p">:</span> <span class="kt">Int</span>

     <span class="kd">func</span> <span class="nf">updatedState</span><span class="p">(</span><span class="k">inout</span> <span class="nv">currentState</span><span class="p">:</span> <span class="kt">GlobalState</span><span class="p">)</span> <span class="p">{</span>
       <span class="n">currentState</span><span class="o">.</span><span class="n">todos</span><span class="o">.</span><span class="nf">remove</span><span class="p">(</span><span class="nv">at</span><span class="p">:</span> <span class="n">index</span><span class="p">)</span>
     <span class="p">}</span>
   <span class="p">}</span>
</code></pre>
<pre class="highlight swift"><code>   <span class="kd">struct</span> <span class="kt">ListLocalState</span><span class="p">:</span> <span class="kt">LocalState</span> <span class="p">{</span>
     <span class="k">var</span> <span class="nv">selectedIndex</span><span class="p">:</span> <span class="kt">Int</span>
   <span class="p">}</span>
</code></pre>
<pre class="highlight swift"><code>   <span class="kd">struct</span> <span class="kt">TodolistViewModel</span><span class="p">:</span> <span class="kt">ViewModelWithLocalState</span> <span class="p">{</span>
     <span class="k">var</span> <span class="nv">todos</span><span class="p">:</span> <span class="p">[</span><span class="kt">String</span><span class="p">]</span>
     <span class="k">var</span> <span class="nv">selectedIndex</span><span class="p">:</span> <span class="kt">Int</span>

     <span class="nf">init</span><span class="p">?(</span><span class="nv">state</span><span class="p">:</span> <span class="kt">GlobalState</span><span class="p">?,</span> <span class="nv">localState</span><span class="p">:</span> <span class="kt">ListLocalState</span><span class="p">)</span> <span class="p">{</span>
       <span class="k">guard</span> <span class="k">let</span> <span class="nv">state</span> <span class="o">=</span> <span class="n">state</span> <span class="k">else</span> <span class="p">{</span> <span class="k">return</span> <span class="kc">nil</span> <span class="p">}</span>
       <span class="k">self</span><span class="o">.</span><span class="n">todos</span> <span class="o">=</span> <span class="n">state</span><span class="o">.</span><span class="n">todos</span>
       <span class="k">self</span><span class="o">.</span><span class="n">selectedIndex</span> <span class="o">=</span> <span class="n">localState</span><span class="o">.</span><span class="n">selectedIndex</span>
     <span class="p">}</span>
   <span class="p">}</span>
</code></pre>
<pre class="highlight swift"><code>   <span class="kd">class</span> <span class="kt">TodoListView</span><span class="p">:</span> <span class="kt">UIView</span><span class="p">,</span> <span class="kt">ViewControllerModellableView</span> <span class="p">{</span>

     <span class="c1">// subviews</span>
     <span class="k">var</span> <span class="nv">todoListView</span> <span class="o">=</span> <span class="kt">ListView</span><span class="p">()</span>

     <span class="c1">// interactions</span>
     <span class="k">var</span> <span class="nv">didTapToRemoveItem</span><span class="p">:</span> <span class="p">((</span><span class="kt">Int</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="p">())?</span>
     <span class="k">var</span> <span class="nv">didSelectItem</span><span class="p">:</span> <span class="p">((</span><span class="kt">Int</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="p">())?</span>

     <span class="c1">// setup</span>
     <span class="kd">func</span> <span class="nf">setup</span><span class="p">()</span> <span class="p">{</span>
       <span class="k">self</span><span class="o">.</span><span class="n">todoListView</span><span class="o">.</span><span class="nf">on</span><span class="p">(</span><span class="o">.</span><span class="n">selection</span><span class="p">)</span> <span class="p">{</span> <span class="p">[</span><span class="k">unowned</span> <span class="k">self</span><span class="p">]</span> <span class="n">indexPath</span> <span class="k">in</span>
         <span class="k">self</span><span class="o">.</span><span class="nf">didSelectItem</span><span class="p">?(</span><span class="n">indexPath</span><span class="o">.</span><span class="n">item</span><span class="p">)</span>
       <span class="p">}</span>
       <span class="k">self</span><span class="o">.</span><span class="n">todoListView</span><span class="o">.</span><span class="nf">on</span><span class="p">(</span><span class="o">.</span><span class="n">deleteItem</span><span class="p">)</span> <span class="p">{</span> <span class="p">[</span><span class="k">unowned</span> <span class="k">self</span><span class="p">]</span> <span class="n">indexPath</span> <span class="k">in</span>
         <span class="n">seld</span><span class="o">.</span><span class="nf">didTapRemoveItem</span><span class="p">?(</span><span class="n">indexPath</span><span class="o">.</span><span class="n">item</span><span class="p">)</span>
       <span class="p">}</span>
       <span class="k">self</span><span class="o">.</span><span class="nf">addSubview</span><span class="p">(</span><span class="k">self</span><span class="o">.</span><span class="n">todoListView</span><span class="p">)</span>
     <span class="p">}</span>

     <span class="c1">// style</span>
     <span class="kd">func</span> <span class="nf">style</span><span class="p">()</span> <span class="p">{</span>
       <span class="k">self</span><span class="o">.</span><span class="n">backgroundColor</span> <span class="o">=</span> <span class="o">.</span><span class="n">white</span>
       <span class="k">self</span><span class="o">.</span><span class="n">todoListView</span><span class="o">.</span><span class="n">backgroundColor</span> <span class="o">=</span> <span class="o">.</span><span class="n">white</span>
     <span class="p">}</span>

     <span class="c1">// update</span>
     <span class="kd">func</span> <span class="nf">update</span><span class="p">(</span><span class="nv">oldModel</span><span class="p">:</span> <span class="kt">CounterViewModel</span><span class="p">?)</span> <span class="p">{</span>
       <span class="k">self</span><span class="o">.</span><span class="n">todoListView</span><span class="o">.</span><span class="n">source</span> <span class="o">=</span> <span class="n">model</span><span class="p">?</span><span class="o">.</span><span class="n">todos</span> <span class="p">??</span> <span class="p">[]</span>
       <span class="k">self</span><span class="o">.</span><span class="n">todoListView</span><span class="o">.</span><span class="n">selectedIndex</span> <span class="o">=</span> <span class="n">model</span><span class="p">?</span><span class="o">.</span><span class="n">todos</span>
     <span class="p">}</span>

     <span class="c1">// layout</span>
     <span class="k">override</span> <span class="kd">func</span> <span class="nf">layoutSubviews</span><span class="p">()</span> <span class="p">{</span>
       <span class="k">self</span><span class="o">.</span><span class="n">todoListView</span><span class="o">.</span><span class="n">frame</span> <span class="o">=</span> <span class="k">self</span><span class="o">.</span><span class="n">bounds</span>
     <span class="p">}</span>
   <span class="p">}</span>
</code></pre>
<pre class="highlight swift"><code>   <span class="kd">class</span> <span class="kt">TodoListViewController</span><span class="p">:</span> <span class="kt">ViewControllerWithLocalState</span><span class="o">&lt;</span><span class="kt">TodoListView</span><span class="o">&gt;</span> <span class="p">{</span>

   <span class="k">override</span> <span class="kd">func</span> <span class="nf">setupInteraction</span><span class="p">()</span> <span class="p">{</span>
     <span class="k">self</span><span class="o">.</span><span class="n">rootView</span><span class="o">.</span><span class="n">didTapRemoveItem</span> <span class="o">=</span> <span class="p">{</span> <span class="p">[</span><span class="k">unowned</span> <span class="k">self</span><span class="p">]</span> <span class="n">index</span> <span class="k">in</span>
       <span class="k">self</span><span class="o">.</span><span class="nf">dispatch</span><span class="p">(</span><span class="kt">RemoveTodo</span><span class="p">(</span><span class="nv">index</span><span class="p">:</span> <span class="n">index</span><span class="p">))</span>
     <span class="p">}</span>
     <span class="k">self</span><span class="o">.</span><span class="n">rootView</span><span class="o">.</span><span class="n">didSelectItem</span> <span class="o">=</span> <span class="p">{</span> <span class="p">[</span><span class="k">unowned</span> <span class="k">self</span><span class="p">]</span> <span class="n">index</span> <span class="k">in</span>
       <span class="k">self</span><span class="o">.</span><span class="n">localState</span><span class="o">.</span><span class="n">selectedIndex</span> <span class="o">=</span> <span class="n">index</span>
     <span class="p">}</span>
   <span class="p">}</span>
</code></pre>

                        <a href="Classes/ViewControllerWithLocalState.html" class="slightly-smaller">See more</a>
                      </div>
                      <div class="declaration">
                        <h4>Declaration</h4>
                        <div class="language">
                          <p class="aside-title">Swift</p>
                          <pre class="highlight swift"><code><span class="kd">open</span> <span class="kd">class</span> <span class="kt">ViewControllerWithLocalState</span><span class="o">&lt;</span><span class="kt">V</span><span class="p">:</span> <span class="kt"><a href="Protocols/ViewControllerModellableView.html">ViewControllerModellableView</a></span> <span class="o">&amp;</span> <span class="kt">UIView</span><span class="o">&gt;</span><span class="p">:</span> <span class="kt"><a href="Classes/ViewController.html">ViewController</a></span><span class="o">&lt;</span><span class="kt">V</span><span class="o">&gt;</span> <span class="k">where</span> <span class="kt">V</span><span class="o">.</span><span class="kt">VM</span><span class="p">:</span> <span class="kt"><a href="Protocols/ViewModelWithLocalState.html">ViewModelWithLocalState</a></span></code></pre>

                        </div>
                      </div>
                      <div class="slightly-smaller">
                        <a href="https://github.com/BendingSpoons/tempura-lib-swift/blob/master//Tempura/Core/ViewControllerWithLocalState.swift#L127-L189">Show on GitHub</a>
                      </div>
                    </section>
                  </div>
                </li>
              </ul>
            </div>
            <div class="task-group">
              <ul>
                <li class="item">
                  <div>
                    <code>
                    <a name="/s:7Tempura9NavigatorC"></a>
                    <a name="//apple_ref/swift/Class/Navigator" class="dashAnchor"></a>
                    <a class="token" href="#/s:7Tempura9NavigatorC">Navigator</a>
                    </code>
                  </div>
                  <div class="height-container">
                    <div class="pointer-container"></div>
                    <section class="section">
                      <div class="pointer"></div>
                      <div class="abstract">
                        <p>Main class that is handling the navigation in a Tempura app.</p>
<h2 id='overview' class='heading'>Overview</h2>

<p>When it comes to creating a complex app, the way you handle the navigation between
different screens is an important factor on the final result.</p>

<p>We believe that relying on the native iOS navigation system, even in a Redux-like
environment like Katana, is the right choice for our stack, because:</p>

<ul>
<li><p>there is no navigation code to write and maintain just to mimic the way
native navigation works</p></li>
<li><p>native navigation gestures will come for free and will stay up to date
with new iOS releases</p></li>
<li><p>the app will feel more <q>native</q></p></li>
</ul>

<p>For these reasons we found a way to reconcile the redux-like world of Katana
with the imperative world of the iOS navigation.</p>
<h2 id='the-routable-protocol' class='heading'>The Routable protocol</h2>

<p>If a Screen (read ViewController) takes an active part on the navigation
(i.e. needs to present another screen) it must conform to the <code><a href="Protocols/RoutableWithConfiguration.html">RoutableWithConfiguration</a></code> protocol.</p>
<pre class="highlight swift"><code>   <span class="kd">protocol</span> <span class="kt">RoutableWithConfiguration</span><span class="p">:</span> <span class="kt">Routable</span> <span class="p">{</span>

     <span class="k">var</span> <span class="nv">routeIdentifier</span><span class="p">:</span> <span class="kt">RouteElementIdentifier</span> <span class="p">{</span> <span class="k">get</span> <span class="p">}</span>

     <span class="k">var</span> <span class="nv">navigationConfiguration</span><span class="p">:</span> <span class="p">[</span><span class="kt">NavigationRequest</span><span class="p">:</span> <span class="kt">NavigationInstruction</span><span class="p">]</span> <span class="p">{</span> <span class="k">get</span> <span class="p">}</span>
   <span class="p">}</span>
</code></pre>
<pre class="highlight swift"><code>   <span class="kd">typealias</span> <span class="kt">RouteElementIdentifier</span> <span class="o">=</span> <span class="kt">String</span>
</code></pre>

<p>Each <code><a href="Protocols/RoutableWithConfiguration.html">RoutableWithConfiguration</a></code> can be asked by the Navigator navigation to
perform a specific navigation task (like present another ViewController)
based on the navigation action (<code><a href="Structs/Show.html">Show</a></code>, <code><a href="Structs/Hide.html">Hide</a></code>) you dispatch.</p>
<h2 id='the-route' class='heading'>The route</h2>

<p>A <code><a href="Typealiases.html#/s:7Tempura5Routea">Route</a></code> is an array that represents a navigation path to a specific screen.</p>
<pre class="highlight swift"><code>   <span class="kd">typealias</span> <span class="kt">Route</span> <span class="o">=</span> <span class="p">[</span><span class="kt">RouteElementIdentifier</span><span class="p">]</span>
</code></pre>
<h2 id='how-the-navigation-works' class='heading'>How the navigation works</h2>

<p>Suppose we have a current <code><a href="Typealiases.html#/s:7Tempura5Routea">Route</a></code> like <a href="being" title="screenB"><q>screenA</q>, <q>screenB</q></a>
the topmost ViewController/RoutableWithConfiguration in the visible hierarchy.</p>

<p>Tempura will expose two main navigation actions:</p>
<h3 id='show' class='heading'>Show</h3>
<pre class="highlight swift"><code>   <span class="kt">Show</span><span class="p">(</span><span class="s">"screenC"</span><span class="p">,</span> <span class="nv">animated</span><span class="p">:</span> <span class="kc">true</span><span class="p">)</span>
</code></pre>

<p>When this action is dispatched, the <code>Navigator</code> will ask <q>screenB</q> (the topmost
<code><a href="Protocols/RoutableWithConfiguration.html">RoutableWithConfiguration</a></code> to handle that action, looking at its
<code>navigationConfiguration</code>).</p>

<p>In order to allow <q>screenB</q> to present <q>screenC</q>, we need to add a <code><a href="Structs/NavigationRequest.html">NavigationRequest</a></code>
inside the <code>navigationConfiguration</code> of <q>screenB</q> that will match the <code>Show(&quot;screenC&quot;)</code> action
with a <code>.show(&quot;screenC&quot;)</code> <code><a href="Structs/NavigationRequest.html">NavigationRequest</a></code>.</p>
<pre class="highlight swift"><code>   <span class="kd">extension</span> <span class="kt">ScreenB</span><span class="p">:</span> <span class="kt">RoutableWithConfiguration</span> <span class="p">{</span>

     <span class="c1">// needed by the `Routable` protocol</span>
     <span class="c1">// to identify this ViewController in the hierarchy</span>
     <span class="k">var</span> <span class="nv">routeIdentifier</span><span class="p">:</span> <span class="kt">RouteElementIdentifier</span> <span class="p">{</span>
       <span class="k">return</span> <span class="s">"screenB"</span>
     <span class="p">}</span>

     <span class="c1">// the `NavigationRequest`s that this ViewController is handling</span>
     <span class="c1">// with the `NavigationInstruction` to execute</span>
     <span class="k">var</span> <span class="nv">navigationConfiguration</span><span class="p">:</span> <span class="p">[</span><span class="kt">NavigationRequest</span><span class="p">:</span> <span class="kt">NavigationInstruction</span><span class="p">]</span> <span class="p">{</span>
       <span class="k">return</span> <span class="p">[</span>
         <span class="o">.</span><span class="nf">show</span><span class="p">(</span><span class="s">"screenC"</span><span class="p">):</span> <span class="o">.</span><span class="nf">presentModally</span><span class="p">({</span> <span class="p">[</span><span class="k">unowned</span> <span class="k">self</span><span class="p">]</span> <span class="n">_</span> <span class="k">in</span>
           <span class="k">let</span> <span class="nv">vc</span> <span class="o">=</span> <span class="kt">ScreenC</span><span class="p">(</span><span class="nv">store</span><span class="p">:</span> <span class="k">self</span><span class="o">.</span><span class="n">store</span><span class="p">)</span>
           <span class="k">return</span> <span class="n">vc</span>
         <span class="p">})</span>
       <span class="p">]</span>
   <span class="p">}</span>
</code></pre>

<p>Inside the <code>.presentModally</code> NavigationInstruction, we create and return the ViewController
that is implementing the <q>screenC</q>.
This will be used by the <code>Navigator</code> to call the appropriate UIKit navigation action (
a <code>UIViewController.present(:animated:completion:)</code> in this case).</p>

<p>If the Navigator will not find a matching NavigationRequest in the navigationConfiguration of
<q>screenB</q>, it will ask to the next RoutableWithConfiguration in the visible hierarchy,
in this case <q>screenA</q>. If nobody is matching that NavigationRequest, a fatalError is thrown.</p>
<h3 id='hide' class='heading'>Hide</h3>

<p>Same will happen when a <code><a href="Structs/Hide.html">Hide</a></code> function is dispatched.</p>
<pre class="highlight swift"><code>   <span class="kt">Hide</span><span class="p">(</span><span class="s">"screenC"</span><span class="p">,</span> <span class="nv">animated</span><span class="p">:</span> <span class="kc">true</span><span class="p">)</span>
</code></pre>

<p>Looking at the current <code><a href="Typealiases.html#/s:7Tempura5Routea">Route</a></code> [<q>screenA</q>, <q>screenB</q>, <q>screenC</q>], the Navigator will ask the
topmost RoutableWithConfiguration (<q>screenC</q> in this case) to match for a
<code>.hide(&quot;screenC&quot;)</code> <code><a href="Structs/NavigationRequest.html">NavigationRequest</a></code>.</p>

<p>Again, if we want <q>screenC</q> to be responsible for dismissing itself, we just need to implement
the matching <code><a href="Structs/NavigationRequest.html">NavigationRequest</a></code> in the <code>navigationConfiguration</code>:</p>
<pre class="highlight swift"><code>   <span class="kd">extension</span> <span class="kt">ScreenC</span><span class="p">:</span> <span class="kt">RoutableWithConfiguration</span> <span class="p">{</span>

     <span class="c1">// needed by the `Routable` protocol</span>
     <span class="c1">// to identify this ViewController in the hierarchy</span>
     <span class="k">var</span> <span class="nv">routeIdentifier</span><span class="p">:</span> <span class="kt">RouteElementIdentifier</span> <span class="p">{</span>
       <span class="k">return</span> <span class="s">"screenC"</span>
     <span class="p">}</span>

     <span class="c1">// the `NavigationRequest`s that this ViewController is handling</span>
     <span class="c1">// with the `NavigationInstruction` to execute</span>
     <span class="k">var</span> <span class="nv">navigationConfiguration</span><span class="p">:</span> <span class="p">[</span><span class="kt">NavigationRequest</span><span class="p">:</span> <span class="kt">NavigationInstruction</span><span class="p">]</span> <span class="p">{</span>
       <span class="k">return</span> <span class="p">[</span>
         <span class="o">.</span><span class="nf">hide</span><span class="p">(</span><span class="s">"screenC"</span><span class="p">):</span> <span class="o">.</span><span class="nf">dismissModally</span><span class="p">(</span><span class="nv">behaviour</span><span class="p">:</span> <span class="o">.</span><span class="n">hard</span><span class="p">)</span>
       <span class="p">]</span>
   <span class="p">}</span>
</code></pre>

<p>If the Navigator will not find a matching NavigationRequest in the navigationConfiguration of
<q>screenC</q>, it will ask to the next RoutableWithConfiguration in the visible hierarchy,
in this case <q>screenB</q>. If nobody is matching that NavigationRequest, a fatalError is thrown.</p>
<h2 id='initializing-the-navigation' class='heading'>Initializing the navigation</h2>

<p>In order to use the navigation system you need to start the Navigator
(typically in your AppDelegate) using the <code>start(using:in:at:)</code> method.
In this method you need to specify a <code><a href="Protocols/RootInstaller.html">RootInstaller</a></code>
and a starting screen.
The RootInstaller (typically your AppDelegate) will be responsible to handle the installation
of the screen you specified before.</p>

<p>Doing so, the Navigator will call the <code>RooInstaller.installRoot(identifier:context:completion:)</code>
method that will handle the setup of the screen to be shown.</p>
<pre class="highlight swift"><code>   <span class="kd">class</span> <span class="kt">AppDelegate</span><span class="p">:</span> <span class="kt">UIResponder</span><span class="p">,</span> <span class="kt">UIApplicationDelegate</span><span class="p">,</span> <span class="kt">RootInstaller</span> <span class="p">{</span>

     <span class="kd">func</span> <span class="nf">application</span><span class="p">(</span><span class="n">_</span> <span class="nv">application</span><span class="p">:</span> <span class="kt">UIApplication</span><span class="p">,</span> <span class="n">didFinishLaunchingWithOptions</span> <span class="o">...</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kt">Bool</span> <span class="p">{</span>
       <span class="o">...</span>
       <span class="c1">// setup the root of the navigation</span>
       <span class="c1">// this is done by invoking this method (and not in the init of the navigator)</span>
       <span class="c1">// because the navigator is instantiated by the Store.</span>
       <span class="c1">// this in turn will invoke the `installRootMethod` of the rootInstaller (self)</span>
       <span class="n">navigator</span><span class="o">.</span><span class="nf">start</span><span class="p">(</span><span class="nv">using</span><span class="p">:</span> <span class="k">self</span><span class="p">,</span> <span class="k">in</span> <span class="k">self</span><span class="o">.</span><span class="n">window</span><span class="p">,</span> <span class="nv">at</span><span class="p">:</span> <span class="s">"screenA"</span><span class="p">)</span>
       <span class="k">return</span> <span class="kc">true</span>
     <span class="p">}</span>

     <span class="c1">// install the root of the app</span>
     <span class="c1">// this method is called by the navigator when needed</span>
     <span class="c1">// you must call the `completion` callback when the navigation has been completed</span>
     <span class="kd">func</span> <span class="nf">installRoot</span><span class="p">(</span><span class="nv">identifier</span><span class="p">:</span> <span class="kt">RouteElementIdentifier</span><span class="p">,</span> <span class="nv">context</span><span class="p">:</span> <span class="kt">Any</span><span class="p">?,</span> <span class="nv">completion</span><span class="p">:</span> <span class="p">()</span> <span class="o">-&gt;</span> <span class="p">())</span> <span class="p">{</span>
       <span class="k">let</span> <span class="nv">vc</span> <span class="o">=</span> <span class="kt">ScreenAViewController</span><span class="p">(</span><span class="nv">store</span><span class="p">:</span> <span class="k">self</span><span class="o">.</span><span class="n">store</span><span class="p">)</span>
       <span class="k">self</span><span class="o">.</span><span class="n">window</span><span class="o">.</span><span class="n">rootViewController</span> <span class="o">=</span> <span class="n">vc</span>
       <span class="nf">completion</span><span class="p">()</span>
     <span class="p">}</span>
   <span class="p">}</span>
</code></pre>

                        <a href="Classes/Navigator.html" class="slightly-smaller">See more</a>
                      </div>
                      <div class="declaration">
                        <h4>Declaration</h4>
                        <div class="language">
                          <p class="aside-title">Swift</p>
                          <pre class="highlight swift"><code><span class="kd">public</span> <span class="kd">class</span> <span class="kt">Navigator</span></code></pre>

                        </div>
                      </div>
                      <div class="slightly-smaller">
                        <a href="https://github.com/BendingSpoons/tempura-lib-swift/blob/master//Tempura/Navigation/Navigator.swift#L172-L434">Show on GitHub</a>
                      </div>
                    </section>
                  </div>
                </li>
              </ul>
            </div>
          </section>
        </section>
        <section id="footer">
          <p>2017 <a class="link" href="https://bendingspoons.com" target="_blank" rel="external">Bending Spoons</a></p>
          <p>Generated by <a class="link" href="https://github.com/realm/jazzy" target="_blank" rel="external">jazzy â™ªâ™« v0.9.1</a>, a <a class="link" href="http://realm.io" target="_blank" rel="external">Realm</a> project.</p>
        </section>
      </article>
    </div>
  </body>
</div>
</html>
