<!DOCTYPE html>
<html lang="en">
  <head>
    <title>Tempura  Reference</title>
    <link rel="stylesheet" type="text/css" href="css/jazzy.css" />
    <link rel="stylesheet" type="text/css" href="css/highlight.css" />
    <meta charset='utf-8'>
    <script src="js/jquery.min.js" defer></script>
    <script src="js/jazzy.js" defer></script>
    
  </head>
  <body>
    <a title="Tempura  Reference"></a>
    <header>
      <div class="content-wrapper">
        <p><a href="index.html">Tempura Docs</a> (100% documented)</p>
        <p class="header-right"><a href="https://github.com/BendingSpoons/tempura-lib-swift"><img src="img/gh.png"/>View on GitHub</a></p>
      </div>
    </header>
    <div class="content-wrapper">
      <p id="breadcrumbs">
        <a href="index.html">Tempura Reference</a>
        <img id="carat" src="img/carat.png" />
        Tempura  Reference
      </p>
    </div>
    <div class="content-wrapper">
      <nav class="sidebar">
        <ul class="nav-groups">
          <li class="nav-group-name">
            <a href="Classes.html">Classes</a>
            <ul class="nav-group-tasks">
              <li class="nav-group-task">
                <a href="Classes/ContainerView.html">ContainerView</a>
              </li>
              <li class="nav-group-task">
                <a href="Classes/Navigator.html">Navigator</a>
              </li>
              <li class="nav-group-task">
                <a href="Classes/ViewController.html">ViewController</a>
              </li>
              <li class="nav-group-task">
                <a href="Classes/ViewControllerWithLocalState.html">ViewControllerWithLocalState</a>
              </li>
            </ul>
          </li>
          <li class="nav-group-name">
            <a href="Enums.html">Enumerations</a>
            <ul class="nav-group-tasks">
              <li class="nav-group-task">
                <a href="Enums/NavigationInstruction.html">NavigationInstruction</a>
              </li>
              <li class="nav-group-task">
                <a href="Enums/NavigationInstruction/ModalDismissBehaviour.html">– ModalDismissBehaviour</a>
              </li>
            </ul>
          </li>
          <li class="nav-group-name">
            <a href="Extensions.html">Extensions</a>
            <ul class="nav-group-tasks">
              <li class="nav-group-task">
                <a href="Extensions/UIApplication.html">UIApplication</a>
              </li>
              <li class="nav-group-task">
                <a href="Extensions/UINavigationController.html">UINavigationController</a>
              </li>
              <li class="nav-group-task">
                <a href="Extensions/UIView.html">UIView</a>
              </li>
              <li class="nav-group-task">
                <a href="Extensions/UIViewController.html">UIViewController</a>
              </li>
            </ul>
          </li>
          <li class="nav-group-name">
            <a href="Protocols.html">Protocols</a>
            <ul class="nav-group-tasks">
              <li class="nav-group-task">
                <a href="Protocols/AnyViewController.html">AnyViewController</a>
              </li>
              <li class="nav-group-task">
                <a href="Protocols/AnyViewControllerModellableView.html">AnyViewControllerModellableView</a>
              </li>
              <li class="nav-group-task">
                <a href="Protocols/LocalState.html">LocalState</a>
              </li>
              <li class="nav-group-task">
                <a href="Protocols/LocalStateableViewModel.html">LocalStateableViewModel</a>
              </li>
              <li class="nav-group-task">
                <a href="Protocols/ModellableView.html">ModellableView</a>
              </li>
              <li class="nav-group-task">
                <a href="Protocols/NavigationProvider.html">NavigationProvider</a>
              </li>
              <li class="nav-group-task">
                <a href="Protocols/RootInstaller.html">RootInstaller</a>
              </li>
              <li class="nav-group-task">
                <a href="Protocols/Routable.html">Routable</a>
              </li>
              <li class="nav-group-task">
                <a href="Protocols/RoutableWithConfiguration.html">RoutableWithConfiguration</a>
              </li>
              <li class="nav-group-task">
                <a href="Protocols/View.html">View</a>
              </li>
              <li class="nav-group-task">
                <a href="Protocols/ViewControllerModellableView.html">ViewControllerModellableView</a>
              </li>
              <li class="nav-group-task">
                <a href="Protocols.html#/s:7Tempura9ViewModelP">ViewModel</a>
              </li>
              <li class="nav-group-task">
                <a href="Protocols/ViewModelWithLocalState.html">ViewModelWithLocalState</a>
              </li>
              <li class="nav-group-task">
                <a href="Protocols/ViewModelWithState.html">ViewModelWithState</a>
              </li>
            </ul>
          </li>
          <li class="nav-group-name">
            <a href="Structs.html">Structures</a>
            <ul class="nav-group-tasks">
              <li class="nav-group-task">
                <a href="Structs/Hide.html">Hide</a>
              </li>
              <li class="nav-group-task">
                <a href="Structs/HideLegacy.html">HideLegacy</a>
              </li>
              <li class="nav-group-task">
                <a href="Structs/Navigate.html">Navigate</a>
              </li>
              <li class="nav-group-task">
                <a href="Structs/NavigateLegacy.html">NavigateLegacy</a>
              </li>
              <li class="nav-group-task">
                <a href="Structs/NavigationRequest.html">NavigationRequest</a>
              </li>
              <li class="nav-group-task">
                <a href="Structs/Show.html">Show</a>
              </li>
              <li class="nav-group-task">
                <a href="Structs/ShowLegacy.html">ShowLegacy</a>
              </li>
            </ul>
          </li>
          <li class="nav-group-name">
            <a href="Typealiases.html">Type Aliases</a>
            <ul class="nav-group-tasks">
              <li class="nav-group-task">
                <a href="Typealiases.html#/s:7Tempura29CustomNavigationOptionClosurea">CustomNavigationOptionClosure</a>
              </li>
              <li class="nav-group-task">
                <a href="Typealiases.html#/s:7Tempura11Interactiona">Interaction</a>
              </li>
              <li class="nav-group-task">
                <a href="Typealiases.html#/s:7Tempura5Routea">Route</a>
              </li>
              <li class="nav-group-task">
                <a href="Typealiases.html#/s:7Tempura22RouteElementIdentifiera">RouteElementIdentifier</a>
              </li>
              <li class="nav-group-task">
                <a href="Typealiases.html#/s:7Tempura17RoutingCompletiona">RoutingCompletion</a>
              </li>
            </ul>
          </li>
        </ul>
      </nav>
      <article class="main-content">
        <section>
          <section class="section">
            
            <p align="center">
  <img src="https://raw.githubusercontent.com/BendingSpoons/tempura-swift/master/.github/Assets/tempura_header.png" alt="Tempura by Bending Spoons" width="400" />
</p>

<p><a href="https://travis-ci.org/BendingSpoons/tempura-swift"><img src="https://travis-ci.org/BendingSpoons/tempura-swift.svg?branch=master" alt="Build Status"></a>
<a href=""><img src="https://img.shields.io/cocoapods/v/Tempura.svg" alt="CocoaPods"></a>
<a href="http://makeapullrequest.com"><img src="https://img.shields.io/badge/PRs-welcome-brightgreen.svg?style=shields" alt="PRs Welcome"></a>
<a href="https://github.com/BendingSpoons/tempura-swift/blob/master/LICENSE.md"><img src="https://img.shields.io/badge/Licence-MIT-lightgrey.svg" alt="Licence"></a></p>

<p>Tempura is a holistic approach to iOS development, it borrows concepts from <a href="https://redux.js.org/">Redux</a> (through <a href="https://github.com/BendingSpoons/katana-swift">Katana</a>) and <a href="https://en.wikipedia.org/wiki/Model%E2%80%93view%E2%80%93viewmodel">MVVM</a>.</p>

<ol>
<li>Model your app state</li>
<li>Define the actions that can change it</li>
<li>Create the UI</li>
<li>Enjoy automatic sync between state and UI</li>
<li>Ship, iterate</li>
</ol>
<h2 id='why-should-i-use-this' class='heading'>Why should I use this?</h2>

<p>We started using Tempura in a small team inside <a href="http://bndspn.com/2HOnxis">Bending Spoons</a>. It worked so well for us, that we ended up developing and maintaining more than twenty high quality apps, with more than 10 million active users in the last year using this approach. Crash rates and development time went down, user engagement and quality went up. We are so satisfied that we wanted to share this with the iOS community, hoping that you will be as excited as we are. ❤️ </p>

<p align="center">
  <a href="https://itunes.apple.com/app/id1099771240"><img src="https://raw.githubusercontent.com/BendingSpoons/tempura-swift/master/.github/Assets/icon1.png" alt="Thirty Day Fitness" width="200" /></a>
  <a href="https://itunes.apple.com/it/app/id509987785"><img src="https://raw.githubusercontent.com/BendingSpoons/tempura-swift/master/.github/Assets/icon2.png" alt="Pic Jointer" width="200" /></a>
  <a href="https://itunes.apple.com/it/app/id1310491340"><img src="https://raw.githubusercontent.com/BendingSpoons/tempura-swift/master/.github/Assets/icon3.png" alt="Rized" width="200" /></a>
  <a href="https://itunes.apple.com/app/id1214593569"><img src="https://raw.githubusercontent.com/BendingSpoons/tempura-swift/master/.github/Assets/icon4.png" alt="ReadIt" width="200" /></a>
</p>
<h2 id='show-me-the-code' class='heading'>Show me the code</h2>

<p>Tempura uses <a href="https://github.com/BendingSpoons/katana-swift">Katana</a> to handle the logic of your app.
Your app state is defined in a single struct.</p>
<pre class="highlight swift"><code><span class="kd">struct</span> <span class="kt">AppState</span><span class="p">:</span> <span class="kt">State</span> <span class="p">{</span>

  <span class="k">var</span> <span class="nv">items</span><span class="p">:</span> <span class="p">[</span><span class="kt">Todo</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span>
    <span class="kt">Todo</span><span class="p">(</span><span class="nv">text</span><span class="p">:</span> <span class="s">"Pet my unicorn"</span><span class="p">),</span>
    <span class="kt">Todo</span><span class="p">(</span><span class="nv">text</span><span class="p">:</span> <span class="s">"Become a doctor.</span><span class="se">\n</span><span class="s">Change last name to Acula"</span><span class="p">),</span>
    <span class="kt">Todo</span><span class="p">(</span><span class="nv">text</span><span class="p">:</span> <span class="s">"Hire two private investigators.</span><span class="se">\n</span><span class="s">Get them to follow each other"</span><span class="p">),</span>
    <span class="kt">Todo</span><span class="p">(</span><span class="nv">text</span><span class="p">:</span> <span class="s">"Visit mars"</span><span class="p">)</span>
  <span class="p">]</span>
<span class="p">}</span>
</code></pre>

<p>You can only manipulate state through <a href="https://github.com/BendingSpoons/katana-swift/blob/master/docs/3.0.0/Protocols/StateUpdater.html">State Updater</a>s. </p>
<pre class="highlight swift"><code><span class="kd">struct</span> <span class="kt">CompleteItem</span><span class="p">:</span> <span class="kt">StateUpdater</span> <span class="p">{</span>
  <span class="k">var</span> <span class="nv">index</span><span class="p">:</span> <span class="kt">Int</span>

  <span class="kd">func</span> <span class="nf">updateState</span><span class="p">(</span><span class="n">_</span> <span class="nv">state</span><span class="p">:</span> <span class="k">inout</span> <span class="kt">AppState</span><span class="p">)</span> <span class="p">{</span>
    <span class="n">state</span><span class="o">.</span><span class="n">items</span><span class="p">[</span><span class="n">index</span><span class="p">]</span><span class="o">.</span><span class="n">completed</span> <span class="o">=</span> <span class="kc">true</span>
  <span class="p">}</span>
<span class="p">}</span>
</code></pre>

<p>The part of the state needed to render the UI of a screen is selected by a <a href="http://tempura.bendingspoons.com/Protocols/ViewModelWithState.html">ViewModelWithState</a>.</p>
<pre class="highlight swift"><code><span class="kd">struct</span> <span class="kt">ListViewModel</span><span class="p">:</span> <span class="kt">ViewModelWithState</span> <span class="p">{</span>
  <span class="k">var</span> <span class="nv">todos</span><span class="p">:</span> <span class="p">[</span><span class="kt">Todo</span><span class="p">]</span>

  <span class="nf">init</span><span class="p">(</span><span class="nv">state</span><span class="p">:</span> <span class="kt">AppState</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">self</span><span class="o">.</span><span class="n">todos</span> <span class="o">=</span> <span class="n">state</span><span class="o">.</span><span class="n">todos</span>
  <span class="p">}</span>
<span class="p">}</span>
</code></pre>

<p>The UI of each screen of your app is composed in a <a href="http://tempura.bendingspoons.com/Protocols/ViewControllerModellableView.html">ViewControllerModellableView</a>. It exposes callbacks (we call them interactions) to signal that a user action occurred. It renders itself based on the ViewModelWithState.</p>
<pre class="highlight swift"><code><span class="kd">class</span> <span class="kt">ListView</span><span class="p">:</span> <span class="kt">UIView</span><span class="p">,</span> <span class="kt">ViewControllerModellableView</span> <span class="p">{</span>
  <span class="c1">// subviews</span>
  <span class="k">var</span> <span class="nv">todoButton</span><span class="p">:</span> <span class="kt">UIButton</span> <span class="o">=</span> <span class="kt">UIButton</span><span class="p">(</span><span class="nv">type</span><span class="p">:</span> <span class="o">.</span><span class="n">custom</span><span class="p">)</span>
  <span class="k">var</span> <span class="nv">todoButton</span><span class="p">:</span> <span class="kt">UIButton</span> <span class="o">=</span> <span class="kt">UIButton</span><span class="p">(</span><span class="nv">type</span><span class="p">:</span> <span class="o">.</span><span class="n">custom</span><span class="p">)</span>
  <span class="k">var</span> <span class="nv">list</span><span class="p">:</span> <span class="kt">CollectionView</span><span class="o">&lt;</span><span class="kt">TodoCell</span><span class="p">,</span> <span class="kt">SimpleSource</span><span class="o">&lt;</span><span class="kt">TodoCellViewModel</span><span class="o">&gt;&gt;</span>

  <span class="c1">// interactions</span>
  <span class="k">var</span> <span class="nv">didTapAddItem</span><span class="p">:</span> <span class="p">((</span><span class="kt">String</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="p">())?</span>
  <span class="k">var</span> <span class="nv">didCompleteItem</span><span class="p">:</span> <span class="p">((</span><span class="kt">String</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="p">())?</span>

  <span class="c1">// update based on ViewModel</span>
  <span class="kd">func</span> <span class="nf">update</span><span class="p">(</span><span class="nv">oldModel</span><span class="p">:</span> <span class="kt">ListViewModel</span><span class="p">?)</span> <span class="p">{</span>
    <span class="k">guard</span> <span class="k">let</span> <span class="nv">model</span> <span class="o">=</span> <span class="k">self</span><span class="o">.</span><span class="n">model</span> <span class="k">else</span> <span class="p">{</span> <span class="k">return</span> <span class="p">}</span>
    <span class="k">let</span> <span class="nv">todos</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">todos</span>
    <span class="k">self</span><span class="o">.</span><span class="n">list</span><span class="o">.</span><span class="n">source</span> <span class="o">=</span> <span class="kt">SimpleSource</span><span class="o">&lt;</span><span class="kt">TodoCellViewModel</span><span class="o">&gt;</span><span class="p">(</span><span class="n">todos</span><span class="p">)</span>
  <span class="p">}</span>
<span class="p">}</span>
</code></pre>

<p>Each screen of your app is managed by a <a href="http://tempura.bendingspoons.com/Classes/ViewController.html">ViewController</a>. Out of the box it will automatically listen for state updates and keep the UI in sync. The only other responsibility of a ViewController is to listen for interactions from the UI and dispatch actions to change the state.</p>
<pre class="highlight swift"><code><span class="kd">class</span> <span class="kt">ListViewController</span><span class="p">:</span> <span class="kt">ViewController</span><span class="o">&lt;</span><span class="kt">ListView</span><span class="o">&gt;</span> <span class="p">{</span>
  <span class="c1">// listen for interactions from the view</span>
  <span class="k">override</span> <span class="kd">func</span> <span class="nf">setupInteraction</span><span class="p">()</span> <span class="p">{</span>
    <span class="k">self</span><span class="o">.</span><span class="n">rootView</span><span class="o">.</span><span class="n">didCompleteItem</span> <span class="o">=</span> <span class="p">{</span> <span class="p">[</span><span class="k">unowned</span> <span class="k">self</span><span class="p">]</span> <span class="n">index</span> <span class="k">in</span>
      <span class="k">self</span><span class="o">.</span><span class="nf">dispatch</span><span class="p">(</span><span class="kt">CompleteItem</span><span class="p">(</span><span class="nv">index</span><span class="p">:</span> <span class="n">index</span><span class="p">))</span>
    <span class="p">}</span>
  <span class="p">}</span>
<span class="p">}</span>
</code></pre>
<h3 id='navigation' class='heading'>Navigation</h3>

<p>Real apps are made by more than one screen. If a screen needs to present another screen, its ViewController must conform to the <a href="http://tempura.bendingspoons.com/Protocols/RoutableWithConfiguration.html">RoutableWithConfiguration</a> protocol.</p>
<pre class="highlight swift"><code><span class="kd">extension</span> <span class="kt">ListViewController</span><span class="p">:</span> <span class="kt">RoutableWithConfiguration</span> <span class="p">{</span>
  <span class="k">var</span> <span class="nv">routeIdentifier</span><span class="p">:</span> <span class="kt">RouteElementIdentifier</span> <span class="p">{</span> <span class="k">return</span> <span class="s">"list screen"</span><span class="p">}</span>

  <span class="k">var</span> <span class="nv">navigationConfiguration</span><span class="p">:</span> <span class="p">[</span><span class="kt">NavigationRequest</span><span class="p">:</span> <span class="kt">NavigationInstruction</span><span class="p">]</span> <span class="p">{</span>
    <span class="k">return</span> <span class="p">[</span>
      <span class="o">.</span><span class="nf">show</span><span class="p">(</span><span class="s">"add item screen"</span><span class="p">):</span> <span class="o">.</span><span class="nf">presentModally</span><span class="p">({</span> <span class="p">[</span><span class="k">unowned</span> <span class="k">self</span><span class="p">]</span> <span class="n">_</span> <span class="k">in</span>
        <span class="k">let</span> <span class="nv">aivc</span> <span class="o">=</span> <span class="kt">AddItemViewController</span><span class="p">(</span><span class="nv">store</span><span class="p">:</span> <span class="k">self</span><span class="o">.</span><span class="n">store</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">aivc</span>
      <span class="p">})</span>
    <span class="p">]</span>
  <span class="p">}</span>
<span class="p">}</span>
</code></pre>

<p>You can then trigger the presentation using one of the navigation actions from the ViewController.</p>
<pre class="highlight swift"><code><span class="k">self</span><span class="o">.</span><span class="nf">dispatch</span><span class="p">(</span><span class="kt">Show</span><span class="p">(</span><span class="s">"add item screen"</span><span class="p">))</span>
</code></pre>

<p>Learn more about the navigation <a href="http://tempura.bendingspoons.com/Classes/Navigator.html">here</a></p>
<h3 id='viewcontroller-containment' class='heading'>ViewController containment</h3>

<p>You can have ViewControllers inside other ViewControllers, this is useful if you want to reuse portions of UI including the logic. To do that, in the parent ViewController you need to provide a <code><a href="Classes/ContainerView.html">ContainerView</a></code> that will receive the view of the child ViewController as subview.</p>
<pre class="highlight swift"><code><span class="kd">class</span> <span class="kt">ParentView</span><span class="p">:</span> <span class="kt">UIView</span><span class="p">,</span> <span class="kt">ViewControllerModellableView</span> <span class="p">{</span>
    <span class="k">var</span> <span class="nv">titleView</span> <span class="o">=</span> <span class="kt">UILabel</span><span class="p">()</span>
    <span class="k">var</span> <span class="nv">childView</span> <span class="o">=</span> <span class="kt">ContainerView</span><span class="p">()</span>

    <span class="kd">func</span> <span class="nf">update</span><span class="p">(</span><span class="nv">oldModel</span><span class="p">:</span> <span class="kt">ParentViewModel</span><span class="p">?)</span> <span class="p">{</span>
      <span class="c1">// update only the titleView, the childView is managed by another VC</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre>

<p>Then, in the parent ViewController you just need to add the child ViewController:</p>
<pre class="highlight swift"><code><span class="kd">class</span> <span class="kt">ParentViewController</span><span class="p">:</span> <span class="kt">ViewController</span><span class="o">&lt;</span><span class="kt">ParentView</span><span class="o">&gt;</span> <span class="p">{</span>
  <span class="k">let</span> <span class="nv">childVC</span><span class="p">:</span> <span class="kt">ChildViewController</span><span class="o">&lt;</span><span class="kt">ChildView</span><span class="o">&gt;!</span>

  <span class="k">override</span> <span class="kd">func</span> <span class="nf">setup</span><span class="p">()</span> <span class="p">{</span>
    <span class="k">self</span><span class="o">.</span><span class="n">childVC</span> <span class="o">=</span> <span class="kt">ChildViewController</span><span class="p">(</span><span class="nv">store</span><span class="p">:</span> <span class="k">self</span><span class="o">.</span><span class="n">store</span><span class="p">)</span>
    <span class="k">self</span><span class="o">.</span><span class="nf">add</span><span class="p">(</span><span class="n">childVC</span><span class="p">,</span> <span class="nv">in</span><span class="p">:</span> <span class="k">self</span><span class="o">.</span><span class="n">rootView</span><span class="o">.</span><span class="n">childView</span><span class="p">)</span>  
  <span class="p">}</span>
<span class="p">}</span>
</code></pre>

<p>All of the automation will work out of the box.
You will now have a <code>ChildViewController</code> inside the <code>ParentViewController</code>, the ChildViewController&rsquo;s view will be hosted inside the <code>childView</code>.</p>
<h3 id='ui-testing' class='heading'>UI Testing</h3>

<p>Tempura has a UI testing system that can be used to take screenshots of your views in all possible states, with all devices and all supported languages.</p>
<h4 id='usage' class='heading'>Usage</h4>

<p>You need to include the <code>TempuraTesting</code> pod in the test target of your app:</p>
<pre class="highlight ruby"><code><span class="n">target</span> <span class="s1">'MyAppTests'</span> <span class="k">do</span>
  <span class="n">pod</span> <span class="s1">'TempuraTesting'</span>
<span class="k">end</span>
</code></pre>

<p>Specify where the screenshots will be placed inside your <code>plist</code> :</p>
<pre class="highlight plaintext"><code>UI_TEST_DIR: $(SOURCE_ROOT)/Demo/UITests
</code></pre>

<p>In Xcode, create a new UI test case class:</p>

<p><code>File -&gt; New -&gt; File... -&gt; UI Test Case Class</code> </p>

<p>Here you can use the <code>test</code> function to take a snapshot of a <code><a href="Protocols/ViewControllerModellableView.html">ViewControllerModellableView</a></code>  with a specific <code><a href="Protocols.html#/s:7Tempura9ViewModelP">ViewModel</a></code>.</p>
<pre class="highlight swift"><code><span class="kd">import</span> <span class="kt">TempuraTesting</span>

<span class="kd">class</span> <span class="kt">UITests</span><span class="p">:</span> <span class="kt">XCTestCase</span><span class="p">,</span> <span class="kt">ViewTestCase</span> <span class="p">{</span>

  <span class="kd">func</span> <span class="nf">testAddItemScreen</span><span class="p">()</span> <span class="p">{</span>
    <span class="k">self</span><span class="o">.</span><span class="nf">uiTest</span><span class="p">(</span><span class="nv">testCases</span><span class="p">:</span> <span class="p">[</span>
      <span class="s">"addItem01"</span><span class="p">:</span> <span class="kt">AddItemViewModel</span><span class="p">(</span><span class="nv">editingText</span><span class="p">:</span> <span class="s">"this is a test"</span><span class="p">)</span>
    <span class="p">])</span>
  <span class="p">}</span>
<span class="p">}</span>

</code></pre>

<p>The identifier will define the name of the snapshot image in the file system.</p>

<p>You can also personalise how the view is rendered (for instance you can embed the view in an instance of UITabBar) using the context parameter. Here is an example that
embeds the view into a tabbar</p>
<pre class="highlight swift"><code><span class="kd">import</span> <span class="kt">TempuraTesting</span>

<span class="kd">class</span> <span class="kt">UITests</span><span class="p">:</span> <span class="kt">XCTestCase</span><span class="p">,</span> <span class="kt">ViewTestCase</span> <span class="p">{</span>

  <span class="kd">func</span> <span class="nf">testAddItemScreen</span><span class="p">()</span> <span class="p">{</span>
    <span class="k">var</span> <span class="nv">context</span> <span class="o">=</span> <span class="kt">UITests</span><span class="o">.</span><span class="kt">Context</span><span class="o">&lt;</span><span class="kt">AddItemView</span><span class="o">&gt;</span><span class="p">()</span>
    <span class="n">context</span><span class="o">.</span><span class="n">container</span> <span class="o">=</span> <span class="o">.</span><span class="n">tabBarController</span>


    <span class="k">self</span><span class="o">.</span><span class="nf">uiTest</span><span class="p">(</span><span class="nv">testCases</span><span class="p">:</span> <span class="p">[</span>
      <span class="s">"addItem01"</span><span class="p">:</span> <span class="kt">AddItemViewModel</span><span class="p">(</span><span class="nv">editingText</span><span class="p">:</span> <span class="s">"this is a test"</span><span class="p">)</span>
    <span class="p">],</span> <span class="nv">context</span><span class="p">:</span> <span class="n">context</span><span class="p">)</span>
  <span class="p">}</span>
<span class="p">}</span>

</code></pre>

<p>If some important content inside a UIScrollView is not fully visibile, you can leverage the <code>scrollViewsToTest(in view: V, identifier: String)</code> method.
This will produce an additional snapshot rendering the full content of each returned UIScrollView instance.</p>

<p>In this example we use <code>scrollViewsToTest(in view: V, identifier: String)</code>  to take an extended snapshot of the <em>mood picker</em> at the bottom of the screen.</p>
<pre class="highlight swift"><code><span class="kd">func</span> <span class="nf">scrollViewsToTest</span><span class="p">(</span><span class="k">in</span> <span class="nv">view</span><span class="p">:</span> <span class="kt">V</span><span class="p">,</span> <span class="nv">identifier</span><span class="p">:</span> <span class="kt">String</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="p">[</span><span class="kt">String</span><span class="p">:</span> <span class="kt">UIScrollView</span><span class="p">]</span> <span class="p">{</span>
  <span class="k">return</span> <span class="p">[</span><span class="s">"mood_collection_view"</span><span class="p">:</span> <span class="n">view</span><span class="o">.</span><span class="n">moodCollectionView</span><span class="p">]</span>
<span class="p">}</span>
</code></pre>

<p><img src="https://raw.githubusercontent.com/BendingSpoons/tempura-swift/master/.github/Assets/screen1.png" height="400" />
<img src="https://raw.githubusercontent.com/BendingSpoons/tempura-swift/master/.github/Assets/screen2.png" /></p>

<p>In case you have to wait for asynchronous operations before rendering the UI and take the screenshot, you can leverage the <code>isViewReady(view:identifier:)</code> method.
For instance, here we wait until an hypotetical view that shows an image from a remote URL is ready. When the image is shown (that is, the state is <code>loaded</code>, then the snapshot is taken)</p>
<pre class="highlight swift"><code><span class="kd">import</span> <span class="kt">TempuraTesting</span>

<span class="kd">class</span> <span class="kt">UITests</span><span class="p">:</span> <span class="kt">XCTestCase</span><span class="p">,</span> <span class="kt">ViewTestCase</span> <span class="p">{</span>

  <span class="kd">func</span> <span class="nf">testAddItemScreen</span><span class="p">()</span> <span class="p">{</span>
    <span class="k">self</span><span class="o">.</span><span class="nf">uiTest</span><span class="p">(</span><span class="nv">testCases</span><span class="p">:</span> <span class="p">[</span>
      <span class="s">"addItem01"</span><span class="p">:</span> <span class="kt">AddItemViewModel</span><span class="p">(</span><span class="nv">editingText</span><span class="p">:</span> <span class="s">"this is a test"</span><span class="p">)</span>
    <span class="p">])</span>
  <span class="p">}</span>

  <span class="kd">func</span> <span class="nf">isViewReady</span><span class="p">(</span><span class="n">_</span> <span class="nv">view</span><span class="p">:</span> <span class="kt">AddItemView</span><span class="p">,</span> <span class="nv">identifier</span><span class="p">:</span> <span class="kt">String</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kt">Bool</span> <span class="p">{</span>
    <span class="k">return</span> <span class="n">view</span><span class="o">.</span><span class="n">remoteImage</span><span class="o">.</span><span class="n">state</span> <span class="o">==</span> <span class="o">.</span><span class="n">loaded</span>
  <span class="p">}</span>
<span class="p">}</span>
</code></pre>

<p>The test will pass as soon as the snapshot is taken.</p>
<h4 id='multiple-devices' class='heading'>Multiple devices</h4>

<p>By default, tests are run only in the device you have choose from xcode (or your device, or CI system). We can run the snapshotting in all the devices by using a script like the following one:</p>
<pre class="highlight shell"><code>xcodebuild <span class="se">\</span>
  -workspace &lt;project&gt;.xcworkspace <span class="se">\</span>
  -scheme <span class="s2">"&lt;target name&gt;"</span> <span class="se">\</span>
  -destination <span class="nv">name</span><span class="o">=</span><span class="s2">"iPhone 5s"</span> <span class="se">\</span>
  -destination <span class="nv">name</span><span class="o">=</span><span class="s2">"iPhone 6 Plus"</span> <span class="se">\</span>
  -destination <span class="nv">name</span><span class="o">=</span><span class="s2">"iPhone 6"</span> <span class="se">\</span>
  -destination <span class="nv">name</span><span class="o">=</span><span class="s2">"iPhone X"</span> <span class="se">\</span>
  -destination <span class="nv">name</span><span class="o">=</span><span class="s2">"iPad Pro (12.9 inch)"</span> <span class="se">\</span>
  <span class="nb">test</span>
</code></pre>

<p>Tests will run in parallel on all the devices. If you want to change the behaviour, refer to the <code>xcodebuild</code> documentation</p>

<p>If you want to test a specific language in the ui test, you can replace the <code>test</code> command with the <code>-testLanguage &lt;iso code639-1&gt;</code>.
The app will be launched in that language and the UITests will be executed with that locale. An example:</p>
<pre class="highlight shell"><code>xcodebuild <span class="se">\</span>
  -workspace &lt;project&gt;.xcworkspace <span class="se">\</span>
  -scheme <span class="s2">"&lt;target name&gt;"</span> <span class="se">\</span>
  -destination <span class="nv">name</span><span class="o">=</span><span class="s2">"iPhone 5s"</span> <span class="se">\</span>
  -destination <span class="nv">name</span><span class="o">=</span><span class="s2">"iPhone 6 Plus"</span> <span class="se">\</span>
  -destination <span class="nv">name</span><span class="o">=</span><span class="s2">"iPhone 6"</span> <span class="se">\</span>
  -destination <span class="nv">name</span><span class="o">=</span><span class="s2">"iPhone X"</span> <span class="se">\</span>
  -destination <span class="nv">name</span><span class="o">=</span><span class="s2">"iPad Pro (12.9 inch)"</span> <span class="se">\</span>
  -testLanguage it
</code></pre>
<h4 id='remote-resources' class='heading'>Remote Resources</h4>

<p>It happens often that the UI needs to show remote content (that is, remote images, remote videos, &hellip;). While executing UITests this could be a problem as:</p>

<ul>
<li>tests may fail due to network or server issues</li>
<li>system should take care of tracking when remote resources are loaded, put them in the UI and only then take the screenshots</li>
</ul>

<p>To fix this issue, Tempura offers a <a href="https://developer.apple.com/documentation/foundation/urlprotocol">URLProtocol</a> subclass named <code>LocalFileURLProtocol</code> that tries to load remote files from your local bundle.</p>

<p>The idea is to put in your (test) bundle all the resources that are needed to render the UI and <code>LocalFileURLProtocol</code> will try to load them instead of making the network request. </p>

<p>Given an url, <code>LocalFileURLProtocol</code> matches the file name using the following rules:</p>

<ul>
<li>search a file that has the url as a name (e.g., <a href="http://example.com/image.png">http://example.com/image.png</a>)</li>
<li>search a file that has the last path component as file name (e.g., image.png)</li>
<li>search a file that has the last path component without extension as file name (e.g., image)</li>
</ul>

<p>if a matching file cannot be retrieved, then the network call is performed.</p>

<p>In order to register <code>LocalFileURLProtocol</code> in your application, you have to invoke the following API as soon as possible in your tests lifecycle:</p>
<pre class="highlight swift"><code><span class="kt">URLProtocol</span><span class="o">.</span><span class="nf">registerClass</span><span class="p">(</span><span class="kt">LocalFileURLProtocol</span><span class="o">.</span><span class="k">self</span><span class="p">)</span>
</code></pre>

<p>Note that if you are using <a href="https://github.com/Alamofire/Alamofire/">Alamofire</a> this won&rsquo;t work. <a href="https://github.com/Alamofire/Alamofire/issues/1247">Here</a> you can find a related issue and a link on how to configure Alamofire to deal with <code>URLProtocol</code> classes.</p>
<h3 id='ui-testing-with-viewcontroller-containment' class='heading'>UI Testing with ViewController containment</h3>

<p><code>ViewTestCase</code> is centred about the use case of testing <code><a href="Protocols/ViewControllerModellableView.html">ViewControllerModellableView</a></code>s with the automatic injection of <code><a href="Protocols.html#/s:7Tempura9ViewModelP">ViewModel</a></code>s representing testing conditions for that View.</p>

<p>In case you are using ViewController containment (like in our <code>ParentView</code> example above) there is part of the View that will not be updated when injecting the ViewModel, as there is another ViewController responsible for that.</p>

<p>In that case you need to scale up and test at the ViewController&rsquo;s level using the <code>ViewControllerTestCase</code> protocol:</p>
<pre class="highlight swift"><code><span class="kd">class</span> <span class="kt">ParentViewControllerUITest</span><span class="p">:</span> <span class="kt">XCTestCase</span><span class="p">,</span> <span class="kt">ViewControllerTestCase</span> <span class="p">{</span>
  <span class="c1">/// provide the instance of the ViewController to test</span>
  <span class="k">var</span> <span class="nv">viewController</span><span class="p">:</span> <span class="kt">ParentViewController</span> <span class="p">{</span>
    <span class="k">let</span> <span class="nv">fakeStore</span> <span class="o">=</span> <span class="kt">Store</span><span class="o">&lt;</span><span class="kt">AppState</span><span class="p">,</span> <span class="kt">EmptySideEffectDependencyContainer</span><span class="o">&gt;</span><span class="p">()</span>
    <span class="k">let</span> <span class="nv">vc</span> <span class="o">=</span> <span class="kt">ParentViewController</span><span class="p">(</span><span class="nv">store</span><span class="p">:</span> <span class="n">testStore</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">vc</span>
  <span class="p">}</span>

  <span class="c1">/// define the ViewModels</span>
  <span class="k">let</span> <span class="nv">vm</span> <span class="o">=</span> <span class="kt">ParentViewModel</span><span class="p">(</span><span class="nv">title</span><span class="p">:</span> <span class="s">"A test title"</span><span class="p">)</span>
  <span class="k">let</span> <span class="nv">childVM</span> <span class="o">=</span> <span class="kt">ChildViewModel</span><span class="p">(</span><span class="nv">value</span><span class="p">:</span> <span class="mi">12</span><span class="p">)</span>

  <span class="c1">/// configure the ViewController with ViewModels, also for the children VCs</span>
  <span class="kd">func</span> <span class="nf">configure</span><span class="p">(</span><span class="nv">vc</span><span class="p">:</span> <span class="kt">ParentViewController</span><span class="p">,</span> <span class="k">for</span> <span class="nv">testCase</span><span class="p">:</span> <span class="kt">String</span><span class="p">)</span> <span class="p">{</span>
    <span class="n">vc</span><span class="o">.</span><span class="n">viewModel</span> <span class="o">=</span> <span class="n">vm</span>
    <span class="n">vc</span><span class="o">.</span><span class="n">childVC</span><span class="o">.</span><span class="n">viewModel</span> <span class="o">=</span> <span class="n">childVM</span>
  <span class="p">}</span>

  <span class="c1">/// execute the UI tests</span>
  <span class="kd">func</span> <span class="nf">test</span><span class="p">()</span> <span class="p">{</span>
    <span class="k">self</span><span class="o">.</span><span class="nf">uiTest</span><span class="p">(</span><span class="nv">testCases</span><span class="p">:</span> <span class="p">[</span><span class="s">"first_test"</span><span class="p">],</span> <span class="nv">context</span><span class="p">:</span> <span class="n">context</span><span class="p">)</span>  
  <span class="p">}</span>
<span class="p">}</span>
</code></pre>
<h2 id='where-to-go-from-here' class='heading'>Where to go from here</h2>
<h3 id='example-application' class='heading'>Example application</h3>

<p>This repository contains a demo of a todo list application done with Tempura. After a <code>pod install</code>, open the project and run the <code>Demo</code> target.</p>
<h3 id='check-out-the-documentation' class='heading'>Check out the documentation</h3>

<p><a href="http://tempura.bendingspoons.com">Documentation</a></p>
<h2 id='swift-version' class='heading'>Swift Version</h2>

<p>Certain versions of Tempura only support certain versions of Swift. Depending on wich version of Swift your project is using, you should use specific versions of Tempura.
Use this table in order to check which version of Tempura you need.</p>

<table><thead>
<tr>
<th>Swift Version</th>
<th>Tempura Version</th>
</tr>
</thead><tbody>
<tr>
<td>Swift 4.2</td>
<td>Tempura 3.0</td>
</tr>
<tr>
<td>Swift 4</td>
<td>Tempura 1.12</td>
</tr>
</tbody></table>
<h2 id='installation' class='heading'>Installation</h2>

<p>Tempura is available through <a href="https://cocoapods.org">CocoaPods</a>.</p>
<h3 id='requirements' class='heading'>Requirements</h3>

<ul>
<li>iOS 9+</li>
<li>Xcode 9.0+</li>
<li>Swift 4.0+</li>
</ul>
<h3 id='cocoapods' class='heading'>CocoaPods</h3>

<p><a href="https://cocoapods.org/">CocoaPods</a> is a dependency manager for Cocoa projects. You can install it with the following command:</p>
<pre class="highlight shell"><code><span class="gp">$ </span>sudo gem install cocoapods
</code></pre>

<p>To integrate Tempura in your Xcode project using CocoaPods you need to create a <code>Podfile</code> with this content:</p>
<pre class="highlight ruby"><code><span class="n">use_frameworks!</span>
<span class="n">source</span> <span class="s1">'https://github.com/CocoaPods/Specs.git'</span>
<span class="n">platform</span> <span class="ss">:ios</span><span class="p">,</span> <span class="s1">'9.0'</span>

<span class="n">target</span> <span class="s1">'MyApp'</span> <span class="k">do</span>
  <span class="n">pod</span> <span class="s1">'Tempura'</span>
<span class="k">end</span>
</code></pre>

<p>Now you just need to run:</p>
<pre class="highlight shell"><code><span class="gp">$ </span>pod install
</code></pre>
<h2 id='get-in-touch' class='heading'>Get in touch</h2>

<p>If you have any <strong>questions</strong> or <strong>feedback</strong> we&rsquo;d love to hear from you at <a href="mailto:opensource@bendingspoons.com">opensource@bendingspoons.com</a></p>
<h2 id='contribute' class='heading'>Contribute</h2>

<ul>
<li>If you&rsquo;ve <strong>found a bug</strong>, open an issue;</li>
<li>If you have a <strong>feature request</strong>, open an issue;</li>
<li>If you <strong>want to contribute</strong>, submit a pull request;</li>
<li>If you <strong>have an idea</strong> on how to improve the framework or how to spread the word, please <a href="https://github.com/BendingSpoons/tempura-swift#get-in-touch">get in touch</a>;</li>
<li>If you want to <strong>try the framework</strong> for your project or to write a demo, please send us the link of the repo.</li>
</ul>
<h2 id='license' class='heading'>License</h2>

<p>Tempura is available under the <a href="https://github.com/BendingSpoons/tempura-swift/blob/master/LICENSE">MIT license</a>.</p>
<h2 id='about' class='heading'>About</h2>

<p>Tempura is maintained by <a href="http://bndspn.com/2HOnxis">Bending Spoons</a>.
We create our own tech products, used and loved by millions all around the world.
Sounds cool? <a href="http://bndspn.com/2ELtTxf">Check us out</a></p>

          </section>
        </section>
        <section id="footer">
          <p>2017 <a class="link" href="https://bendingspoons.com" target="_blank" rel="external">Bending Spoons</a></p>
          <p>Generated by <a class="link" href="https://github.com/realm/jazzy" target="_blank" rel="external">jazzy ♪♫ v0.9.1</a>, a <a class="link" href="http://realm.io" target="_blank" rel="external">Realm</a> project.</p>
        </section>
      </article>
    </div>
  </body>
</div>
</html>
